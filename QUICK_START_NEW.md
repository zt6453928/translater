# 🚀 新版PDF翻译器快速开始指南

## ✨ 最新更新

已切换到 **Claude 4.5 Sonnet Think** 模型，具有更强的推理能力和更好的翻译质量！

## 🎯 主要改进

### 1. **使用Claude 4.5 Sonnet Think模型**
   - ✅ 更智能的翻译
   - ✅ 更好的数学公式处理
   - ✅ 自动清除方框字符
   - ✅ 完美处理参考文献上标

### 2. **数学公式自动转换**
   所有LaTeX公式自动转换为Unicode：
   
   | 输入 | 输出 | 说明 |
   |------|------|------|
   | `Wang $^{1,2,3}$` | 王海洋¹,²,³ | 作者上标 |
   | `$\delta^{13}\mathrm{C}$` | δ¹³C | 同位素标记 |
   | `$\mathrm{O}_2$` | O₂ | 化学式下标 |
   | `$^{12-14}$` | ¹²⁻¹⁴ | 范围标注 |
   | `$5.0 \pm 0.3$` | 5.0 ± 0.3 | 数学符号 |
   | `$\sim 7$` | ∼7 | 波浪号 |

### 3. **完全清除方框字符**
   AI会自动识别并移除所有无法显示的字符（显示为□的字符）

## 📝 使用步骤

### 1. 启动服务
```bash
cd /Users/enithz/Desktop/pdfnew
python3 app.py
```

### 2. 访问界面
打开浏览器访问：
```
http://localhost:8000/full
```

### 3. 翻译PDF
1. 点击"选择文件"上传PDF
2. 可选：设置处理页数（留空处理全部）
3. 点击"开始翻译"
4. 等待处理完成（AI翻译需要时间）
5. 下载翻译后的PDF

## 🔍 处理流程

```
上传PDF
   ↓
MinerU 2.5 解析 (PDF → Markdown)
   ↓
清理Unicode字符
   ↓
Claude 4.5 Sonnet Think 翻译 + 公式处理
   ↓
生成中文PDF
   ↓
下载结果
```

## 📊 控制台输出示例

翻译过程中会看到：

```
==================================================
开始AI翻译...
==================================================
内容较短，一次性翻译...
正在使用AI翻译（长度: 4789 字符）...
✓ AI翻译完成（已过滤思考过程，输出长度: 5234 字符）
==================================================
✓ AI翻译完成！

✓ 翻译后的Markdown已保存到: /tmp/.../translated_xxx.md
生成PDF...

==================================================
开始清理Markdown文本中的问题字符...
原始文本长度: 5234
==================================================
✓ 没有发现需要移除的问题字符
✓ 替换了 X 个特殊Unicode字符
清理后文本长度: 5234
==================================================

✓ 成功注册字体: /System/Library/Fonts/STHeiti Light.ttc
✓ PDF生成成功: /tmp/.../translated_xxx.pdf
```

## 🧪 测试翻译效果

运行测试脚本：

```bash
python3 test_ai_translation.py
```

预期看到类似输出：

```
✓ 翻译成功！

翻译结果:
------------------------------------------------------------
# 测试文章

王海洋¹,²,³, 彭永波¹,⁴, 李超²,³,⁵

这是一个包含数学公式的测试段落:δ¹³C 和 O₂。

该值约为 5.0 ± 0.3,范围从¹²⁻¹⁴到¹⁹⁻²¹。
------------------------------------------------------------
```

## ⚙️ 配置说明

配置文件：`config.py`

```python
# 当前使用的AI模型配置
AI_TRANSLATE_MODEL = "claude-4.5-sonnet-think"
AI_TRANSLATE_TIMEOUT = 180  # 3分钟超时
AI_TRANSLATE_MAX_TOKENS = 8000  # 最大输出token数
```

## 💡 注意事项

1. **处理时间**
   - Think模型需要更多时间进行推理
   - 长文档会自动分块处理（每块最多3000字符）
   - 请耐心等待，不要关闭浏览器

2. **网络要求**
   - 需要稳定的网络连接
   - 超时时间设置为180秒

3. **结果验证**
   - 下载PDF后检查：
     - 是否还有方框字符（□）
     - 数学公式是否正确显示
     - 翻译质量是否满意

4. **调试文件**
   翻译过程中会保存以下文件到临时目录：
   - `markdown_xxx.md` - 原始解析的Markdown
   - `translated_xxx.md` - 翻译后的Markdown
   - `task_xxx.json` - MinerU任务结果

## 🐛 问题排查

### 如果还有方框字符

1. 检查控制台输出，看是否有"移除了X种问题字符"
2. 查看保存的 `translated_xxx.md` 文件，确认AI输出
3. 如果问题持续，可以增加 `AI_TRANSLATE_MAX_TOKENS` 的值

### 如果翻译超时

1. 增加 `AI_TRANSLATE_TIMEOUT` 到更大的值（如300秒）
2. 或者设置"处理页数"只处理部分页面

### 如果公式不正确

1. 查看控制台的"✓ 公式转换"输出
2. 检查 `translated_xxx.md` 文件中公式是否正确
3. 可能需要调整系统提示词

## 📚 相关文档

- `AI_TRANSLATION_README.md` - 详细的AI翻译功能说明
- `config.py` - 完整的配置选项
- `test_ai_translation.py` - 测试脚本

## 🎉 成功标志

翻译成功后，您的PDF应该：
- ✅ 完全是中文（除了专有名词）
- ✅ 没有任何方框字符（□）
- ✅ 数学公式正确显示（如 δ¹³C, O₂）
- ✅ 参考文献上标正确（如 ¹,²,³）
- ✅ 格式整洁、易读
