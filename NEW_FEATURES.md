# 🎉 新功能说明

## ✨ 最新更新

### 1. 修复上传问题 ✅
- **问题**: 之前需要点击两次才能上传文件
- **修复**: 优化了事件处理，现在只需点击一次即可

### 2. API配置选择 ✅
- **新增**: 单选按钮选择要使用的API配置
- **功能**: 可以添加多个API配置，选择其中一个使用

---

## 📋 如何使用

### 上传文件（已修复）

```
┌─────────────────────────┐
│    📤 上传图标          │
│  选择或拖拽PDF文件       │
│    支持最大 50MB        │
│   [选择文件]           │
└─────────────────────────┘
         ↓
    点击一次即可 ✅
```

### API配置选择（新功能）

#### 解析API Key

```
┌─────────────────────────────┐
│ 解析API Key          [+ 添加] │
├─────────────────────────────┤
│ ┌─────────────────────┐     │
│ │ ○ API Key 1    [🗑️]│  ← 未选中
│ │ 名称: [主Key      ]│     │
│ │ Key:  [*********  ]│     │
│ └─────────────────────┘     │
│                             │
│ ┌─────────────────────┐     │
│ │ ● 备用Key      [🗑️]│  ← 已选中 ✓
│ │ 名称: [备用Key    ]│     │  蓝色高亮
│ │ Key:  [*********  ]│     │
│ └─────────────────────┘     │
└─────────────────────────────┘
```

**使用步骤：**
1. 添加多个API Key
2. 点击单选按钮选择要使用的Key
3. 选中后卡片会高亮显示（蓝色背景）
4. 翻译时自动使用选中的Key

#### 翻译AI API

```
┌─────────────────────────────────┐
│ 翻译AI API              [+ 添加] │
├─────────────────────────────────┤
│ ┌───────────────────────────┐   │
│ │ ● Claude 4.5       [🗑️]│  ← 已选中 ✓
│ │ 名称:  [Claude 4.5      ] │   │  蓝色高亮
│ │ URL:   [https://...     ] │   │
│ │ Key:   [sk-*********    ] │   │
│ │ 模型:  [claude-4.5...   ] │   │
│ └───────────────────────────┘   │
│                                 │
│ ┌───────────────────────────┐   │
│ │ ○ GPT-4            [🗑️]│  ← 未选中
│ │ 名称:  [GPT-4          ] │   │
│ │ URL:   [https://...    ] │   │
│ │ Key:   [sk-*********   ] │   │
│ │ 模型:  [gpt-4          ] │   │
│ └───────────────────────────┘   │
└─────────────────────────────────┘
```

**使用步骤：**
1. 添加多个翻译AI配置
2. 点击单选按钮选择要使用的API
3. 选中后卡片会高亮显示（蓝色背景）
4. 翻译时自动使用选中的API配置

---

## 🎯 功能特点

### 单选按钮
- ⚪ 未选中状态：灰色空心圆
- 🔵 已选中状态：蓝色实心圆
- 点击即可切换选择

### 卡片高亮
- 未选中：白色背景
- 已选中：蓝色渐变背景 + 蓝色边框
- 鼠标悬停：显示边框高亮

### Toast通知
- 不再使用alert弹窗
- 右下角优雅的通知提示
- 3秒后自动消失
- 支持不同类型：
  - ✅ 成功（绿色）
  - ❌ 错误（红色）
  - ⚠️ 警告（橙色）
  - ℹ️ 信息（蓝色）

---

## 💡 使用场景

### 场景1：测试不同的Key

```
1. 添加"主Key"和"测试Key"
2. 先用"测试Key"翻译1页试试
3. 确认效果后切换到"主Key"翻译完整文档
```

### 场景2：切换不同的AI模型

```
1. 添加"Claude 4.5"和"GPT-4"
2. 对比不同模型的翻译效果
3. 选择最佳效果的模型继续使用
```

### 场景3：API额度管理

```
1. 添加多个API Key
2. 当一个Key额度用完时
3. 切换到另一个Key继续使用
```

---

## 🎨 界面说明

### 选中状态视觉

**未选中的API配置：**
```
┌─────────────────────┐
│ ○ API名称      [🗑️]│  ← 白色背景
│ [配置内容...]        │     灰色边框
└─────────────────────┘
```

**已选中的API配置：**
```
┌─────────────────────┐
│ ● API名称      [🗑️]│  ← 蓝色渐变背景
│ [配置内容...]        │     蓝色边框
└─────────────────────┘     外发光效果
```

### Toast通知示例

```
页面右下角：
┌─────────────────────────┐
│ ✓  已选择此解析API       │  ← 3秒后消失
└─────────────────────────┘
```

---

## 🔄 工作流程

### 完整使用流程

```
1. 添加API配置
   ↓
2. 选择要使用的API（点击单选按钮）
   ↓
3. 看到Toast通知："已选择此XXX API"
   ↓
4. 卡片高亮显示（蓝色背景）
   ↓
5. 上传PDF文件（点击一次）
   ↓
6. 点击"开始翻译"
   ↓
7. 系统使用选中的API进行翻译
   ↓
8. 自动下载结果
```

---

## 📱 移动端适配

### Toast通知
- 移动端：底部全宽显示
- 桌面端：右下角固定宽度

### 单选按钮
- 触摸友好的大小（18px）
- 点击区域足够大
- 视觉反馈清晰

---

## 🔧 技术细节

### 数据存储

```javascript
// 保存API配置
localStorage.setItem('parseAPIs', JSON.stringify([...]))
localStorage.setItem('translateAPIs', JSON.stringify([...]))

// 保存选择状态（自动）
selectedParseAPI = 123456789
selectedTranslateAPI = 987654321
```

### API提交

翻译时，系统会提交选中的API配置：

```javascript
// 解析API
formData.append('parse_api_token', selectedAPI.token)

// 翻译API
formData.append('translate_api_url', selectedAPI.url)
formData.append('translate_api_key', selectedAPI.apiKey)
formData.append('translate_api_model', selectedAPI.model)
```

---

## ⚡ 快速测试

### 1. 测试上传修复
```
1. 访问页面
2. 点击上传区域一次
3. 应该立即打开文件选择器 ✅
```

### 2. 测试API选择
```
1. 添加2个解析API Key
2. 点击第二个的单选按钮
3. 应该看到：
   - Toast通知："已选择此解析API"
   - 第二个卡片变蓝色高亮
4. 刷新页面
5. 第二个卡片应该仍然是选中状态 ✅
```

### 3. 测试Toast通知
```
1. 选择任意API
2. 应该在右下角看到通知
3. 3秒后自动消失 ✅
```

---

## 🐛 故障排除

### 上传还是需要点击两次？
- 清除浏览器缓存（Ctrl+Shift+R）
- 确保使用最新的main.js

### 选择不生效？
- 检查浏览器控制台是否有错误
- 确认localStorage可用
- 尝试清除localStorage重新配置

### Toast不显示？
- 检查是否有CSS冲突
- 确认浏览器支持CSS过渡
- 查看浏览器控制台

---

## 📝 注意事项

1. **默认选择**
   - 添加第一个API时自动选中
   - 无需手动选择即可使用

2. **配置持久化**
   - 选择状态会保存
   - 下次访问自动恢复
   - 删除API时自动切换到第一个

3. **无配置时**
   - 解析：使用默认Key
   - 翻译：使用默认配置

---

## 🎯 下一步

### 建议操作
1. ✅ 清除浏览器缓存
2. ✅ 刷新页面
3. ✅ 测试上传功能
4. ✅ 添加API配置
5. ✅ 选择API并测试
6. ✅ 开始翻译！

---

**更新时间**: 2025-12-11  
**版本**: 2.1.0  
**新功能**: 上传修复 + API选择 + Toast通知
