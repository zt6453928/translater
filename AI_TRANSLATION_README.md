# AI翻译功能说明

## 🎉 新功能

现在PDF翻译器使用**Claude 4.5 Sonnet**进行智能翻译，可以：

1. ✅ **准确翻译**：使用先进的AI模型进行学术论文翻译
2. ✅ **自动处理数学公式**：将LaTeX公式自动转换为Unicode格式
3. ✅ **保持格式**：保留Markdown格式和结构
4. ✅ **智能上下文**：理解上下文，提供更准确的翻译

## 📋 工作流程

```
PDF文件 
  ↓
MinerU 2.5 API (PDF解析 → Markdown)
  ↓
Claude 4.5 Sonnet (翻译 + 公式处理)
  ↓
ReportLab (生成中文PDF)
```

## 🔧 配置信息

在 `config.py` 中配置：

```python
# AI翻译API配置
AI_TRANSLATE_API_URL = "https://b4u.qzz.io/v1/chat/completions"
AI_TRANSLATE_API_KEY = "sk-xMADfHsmiaSmJBDVni7f1BDxNdidPFboYf73o7LeOhPxQNOe"
AI_TRANSLATE_MODEL = "claude-4.5-sonnet"
```

## 🎯 数学公式处理

AI会自动将LaTeX数学公式转换为Unicode字符：

| LaTeX | Unicode | 示例 |
|-------|---------|------|
| 上标 | ⁰¹²³⁴⁵⁶⁷⁸⁹⁺⁻ | `^{13}C` → `¹³C` |
| 下标 | ₀₁₂₃₄₅₆₇₈₉₊₋ | `O_2` → `O₂` |
| 希腊字母 | α β γ δ ε ... | `\delta` → `δ` |
| 数学符号 | ± × ÷ ≤ ≥ ≠ ≈ ∞ | `\pm` → `±` |

## 📊 测试示例

**输入:**
```
$\delta^{13}\mathrm{C}$ and $\mathrm{O}_2$
The value is $5.0 \pm 0.3$
```

**输出:**
```
δ¹³C 和 O₂
该值为 5.0 ± 0.3
```

## 🚀 使用方法

1. **启动服务**
   ```bash
   python3 app.py
   ```

2. **访问界面**
   ```
   http://localhost:8000/full
   ```

3. **上传PDF**
   - 选择要翻译的PDF文件
   - 点击"开始翻译"
   - 等待处理完成（AI翻译需要一定时间）
   - 下载翻译后的PDF

## 📝 注意事项

1. **处理时间**：AI翻译比传统翻译慢，但质量更高
2. **文本长度**：长文档会自动分块处理（每块最多3000字符）
3. **保存记录**：翻译后的Markdown会保存在临时目录中
4. **控制台日志**：查看详细的翻译进度和调试信息

## 🐛 调试

如果遇到问题，检查控制台输出：

```
==================================================
开始AI翻译...
==================================================
正在使用AI翻译（长度: 4789 字符）...
✓ AI翻译完成（输出长度: 5234 字符）
==================================================
✓ AI翻译完成！
```

## 🧪 测试AI翻译

运行测试脚本验证API连接：

```bash
python3 test_ai_translation.py
```

预期输出：
```
✓ 翻译成功！
```

## 🔄 与旧版本的区别

| 特性 | 旧版本 (DeepLX) | 新版本 (AI) |
|------|----------------|------------|
| 翻译质量 | 一般 | 优秀 |
| 数学公式 | 需手动处理 | 自动处理 |
| 上下文理解 | 基础 | 智能 |
| 处理速度 | 快 | 较慢但更准确 |
| 专业术语 | 一般 | 准确 |

## 💡 提示

- 首次使用建议先测试一页内容，确认效果
- 检查生成的PDF中数学公式是否正确显示
- 如需调整翻译风格，可修改 `app.py` 中的系统提示词
